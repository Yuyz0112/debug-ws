const express = require('express');
const WebSocket = require('ws');
const http = require('http');

const app = express();
app.use(express.static('public'));
const server = http.createServer(app);

const wss = new WebSocket.Server({ server });

const str = '{"action":"create","action_id":18,"payload":{"block_volume":{"access_path":null,"action_status":"active","allocated_size":0,"block_snapshot_num":0,"client_group_num":0,"client_groups":null,"create":"2017-10-27T08:39:52.074398Z","description":"","flattened":true,"id":6,"name":"batch-volume-test--5","passive":false,"pool":{"action_status":"active","block_volume_num":0,"cache_pool":null,"coding_chunk_num":0,"create":"2017-10-27T08:38:52.095474Z","data_chunk_num":0,"device_type":"Hybrid","failure_domain_type":"host","id":1,"name":"block-storage-pool-test","osd_num":0,"osds":[{"action_status":"active","create":"2017-10-27T08:38:00.709654Z","data_dir":"/var/lib/ceph/osd/ceph-2","disk":{"action_status":"","bytes":0,"cache_create":"0001-01-01T00:00:00Z","create":"0001-01-01T00:00:00Z","device":"","disk_type":"","host":null,"id":2,"is_cache":false,"lighting_status":"","model":"","partition_num":0,"partitions":null,"rotation_rate":"","rotational":false,"serial":"","smart_attrs":null,"ssd_life_left":null,"status":"","update":"0001-01-01T00:00:00Z","used":false,"wwid":""},"id":3,"in":true,"init_time":"2017-10-27T08:38:44.213393Z","last_scrub_time":"0001-01-01T00:00:00Z","meta_bytes":104857600,"name":"osd.2","osd_id":2,"partition":{"create":"0001-01-01T00:00:00Z","disk":null,"id":5,"path":"","size":0,"update":"0001-01-01T00:00:00Z","used":false,"uuid":""},"pool":{"action_status":"","block_volume_num":0,"cache_pool":null,"coding_chunk_num":0,"create":"0001-01-01T00:00:00Z","data_chunk_num":0,"device_type":"","failure_domain_type":"","id":1,"name":"","osd_num":0,"osds":null,"pool_id":0,"pool_mode":"","pool_name":"","pool_role":"","pool_type":"","primary_placement_node":null,"property":null,"protection_domain":null,"qos":null,"replicate_size":0,"status":"","tier_status":"","update":"0001-01-01T00:00:00Z"},"read_cache_size":268435456,"role":"data","status":"active","type":"","up":true,"update":"2017-10-27T08:38:52.099579Z","uuid":"d06d5cfc-d5bc-4cef-a6d4-d5e6c6fa91a5"},{"action_status":"active","create":"2017-10-27T08:37:05.022713Z","data_dir":"/var/lib/ceph/osd/ceph-1","disk":{"action_status":"","bytes":0,"cache_create":"0001-01-01T00:00:00Z","create":"0001-01-01T00:00:00Z","device":"","disk_type":"","host":null,"id":3,"is_cache":false,"lighting_status":"","model":"","partition_num":0,"partitions":null,"rotation_rate":"","rotational":false,"serial":"","smart_attrs":null,"ssd_life_left":null,"status":"","update":"0001-01-01T00:00:00Z","used":false,"wwid":""},"id":2,"in":true,"init_time":"2017-10-27T08:37:49.928494Z","last_scrub_time":"0001-01-01T00:00:00Z","meta_bytes":104857600,"name":"osd.1","osd_id":1,"partition":{"create":"0001-01-01T00:00:00Z","disk":null,"id":3,"path":"","size":0,"update":"0001-01-01T00:00:00Z","used":false,"uuid":""},"pool":{"action_status":"","block_volume_num":0,"cache_pool":null,"coding_chunk_num":0,"create":"0001-01-01T00:00:00Z","data_chunk_num":0,"device_type":"","failure_domain_type":"","id":1,"name":"","osd_num":0,"osds":null,"pool_id":0,"pool_mode":"","pool_name":"","pool_role":"","pool_type":"","primary_placement_node":null,"property":null,"protection_domain":null,"qos":null,"replicate_size":0,"status":"","tier_status":"","update":"0001-01-01T00:00:00Z"},"read_cache_size":268435456,"role":"data","status":"active","type":"","up":true,"update":"2017-10-27T08:38:52.100126Z","uuid":"3a95d9be-b196-456e-8836-b7d3869fa73b"},{"action_status":"active","create":"2017-10-27T08:35:34.295386Z","data_dir":"/var/lib/ceph/osd/ceph-0","disk":{"action_status":"","bytes":0,"cache_create":"0001-01-01T00:00:00Z","create":"0001-01-01T00:00:00Z","device":"","disk_type":"","host":null,"id":5,"is_cache":false,"lighting_status":"","model":"","partition_num":0,"partitions":null,"rotation_rate":"","rotational":false,"serial":"","smart_attrs":null,"ssd_life_left":null,"status":"","update":"0001-01-01T00:00:00Z","used":false,"wwid":""},"id":1,"in":true,"init_time":"2017-10-27T08:36:52.39905Z","last_scrub_time":"0001-01-01T00:00:00Z","meta_bytes":104857600,"name":"osd.0","osd_id":0,"partition":{"create":"0001-01-01T00:00:00Z","disk":null,"id":1,"path":"","size":0,"update":"0001-01-01T00:00:00Z","used":false,"uuid":""},"pool":{"action_status":"","block_volume_num":0,"cache_pool":null,"coding_chunk_num":0,"create":"0001-01-01T00:00:00Z","data_chunk_num":0,"device_type":"","failure_domain_type":"","id":1,"name":"","osd_num":0,"osds":null,"pool_id":0,"pool_mode":"","pool_name":"","pool_role":"","pool_type":"","primary_placement_node":null,"property":null,"protection_domain":null,"qos":null,"replicate_size":0,"status":"","tier_status":"","update":"0001-01-01T00:00:00Z"},"read_cache_size":268435456,"role":"data","status":"active","type":"","up":true,"update":"2017-10-27T08:38:52.100618Z","uuid":"0c6da894-07ac-43a7-8356-ac20b8f62cdd"}],"pool_id":1,"pool_mode":"active","pool_name":"pool-17c491db8e9e44048b8809b7c055cd25","pool_role":"block","pool_type":"replicated","primary_placement_node":null,"property":{"osd_full_ratio":0.9,"scrub_begin":"00:00","scrub_end":"00:00"},"protection_domain":{"create":"2017-10-27T08:30:13.938889Z","description":"The first protection domain","id":1,"name":"default","placement_node":{"create":"0001-01-01T00:00:00Z","id":1,"name":"","parent":null,"type":"","update":"0001-01-01T00:00:00Z"},"status":"active","update":"2017-10-27T08:30:13.938892Z"},"qos":{"bandwidth":10485760,"bandwidth_max":0,"client_threshold":0,"id":1,"mode":1},"replicate_size":3,"status":"active","tier_status":"","update":"2017-10-27T08:38:52.095476Z"},"progress":null,"protection_group":null,"qos":null,"qos_enabled":false,"size":644245094400,"sn":"153d10b98218345d","snapshot":null,"status":"active","update":"2017-10-27T08:39:52.0744Z","volume_name":"volume-5c4856ec58fe4d629cac9ed2eb26375e"}},"resource":"block_volume","stage":"end","success":true,"uuid":"5bc4c3c6aeda465b8785bdb8bc10118d"}';

wss.on('connection', ws => {
  ws.send('ping');
  ws.send('hello');
  ws.send(str);
});

server.listen(18088);
